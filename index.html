<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKR Gold Tracker | Premium</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Lexend:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Lexend', 'sans-serif'], // Using Lexend for numbers for that fintech look
                    },
                    colors: {
                        darkBg: '#0a0a0a',
                        lightBg: '#f5f5f7',
                        gold: '#D4AF37',
                    },
                    animation: {
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        shimmer: {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Glassmorphism Logic */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .light .glass {
            background: rgba(255, 255, 255, 0.75);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }

        /* Shimmer Effect for Loading */
        .shimmer-bg {
            background: linear-gradient(to right, rgba(255,255,255,0.05) 8%, rgba(255,255,255,0.1) 18%, rgba(255,255,255,0.05) 33%);
            background-size: 1000px 100%;
        }
        .light .shimmer-bg {
            background: linear-gradient(to right, rgba(0,0,0,0.05) 8%, rgba(0,0,0,0.1) 18%, rgba(0,0,0,0.05) 33%);
        }

        /* Transitions */
        body { transition: background-color 0.3s ease, color 0.3s ease; }
    </style>
</head>
<body class="bg-darkBg text-white h-screen w-screen flex flex-col items-center justify-center relative overflow-hidden selection:bg-gold selection:text-black">

    <div class="absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-gold/10 rounded-full blur-[120px] pointer-events-none"></div>
    <div class="absolute bottom-[-20%] right-[-10%] w-[500px] h-[500px] bg-blue-500/5 rounded-full blur-[120px] pointer-events-none"></div>

    <button id="themeToggle" class="absolute top-6 right-6 p-3 rounded-full glass hover:bg-white/5 transition-all z-20">
        <svg id="sun" class="w-5 h-5 hidden text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
        <svg id="moon" class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 24.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
    </button>

    <main class="glass w-full max-w-sm md:max-w-md rounded-3xl p-8 md:p-10 relative z-10 mx-4 shadow-2xl">
        
        <div class="text-center mb-8">
            <h2 class="text-[10px] uppercase tracking-[0.25em] text-gold font-bold mb-2">Live Market Data</h2>
            <h1 class="text-2xl font-light dark:text-white text-gray-900">Gold Rate <span class="font-medium">Pakistan</span></h1>
            <p class="text-xs mt-1 opacity-50 font-sans">Per Tola (24K)</p>
        </div>

        <div class="text-center mb-10 min-h-[140px] flex flex-col justify-center">
            
            <div id="loader" class="animate-pulse w-full">
                <div class="h-14 w-3/4 mx-auto rounded-lg shimmer-bg animate-shimmer mb-4"></div>
                <div class="h-4 w-1/2 mx-auto rounded shimmer-bg animate-shimmer"></div>
            </div>

            <div id="content" class="hidden transition-opacity duration-700 opacity-0">
                <div class="flex items-start justify-center gap-1 mb-2">
                    <span class="text-xl mt-2 font-light text-gold font-sans">Rs.</span>
                    <span id="pricePKR" class="text-6xl font-bold tracking-tight font-mono dark:text-white text-gray-900">0</span>
                </div>
                
                <div class="flex flex-col gap-1 items-center justify-center text-xs opacity-60 font-mono">
                    <div class="flex gap-3">
                        <span>Gold: <span id="priceUSD">--</span> USD/oz</span>
                        <span class="opacity-30">|</span>
                        <span>1 USD = <span id="ratePKR">--</span> PKR</span>
                    </div>
                </div>

                <div class="mt-6 inline-block">
                    <div class="group relative inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-black/5 dark:bg-white/5 border border-black/5 dark:border-white/10 cursor-help transition-colors hover:border-gold/30">
                        <span class="w-1.5 h-1.5 rounded-full bg-gold animate-pulse"></span>
                        <span class="text-[10px] uppercase tracking-wide font-medium opacity-80">Local Adjustment Applied</span>
                        
                        <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-[10px] rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50">
                            Base Price + Rs. 2,000 Premium
                            <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="pt-6 border-t border-white/10 dark:border-white/10 border-black/5 flex justify-between items-end">
            <div>
                <p class="text-[9px] uppercase tracking-widest opacity-40 mb-1">Last Update</p>
                <p id="timestamp" class="text-[11px] font-mono opacity-70">Fetching...</p>
            </div>
            <div class="flex gap-1">
                <div class="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                <p class="text-[9px] uppercase tracking-widest opacity-40">Live</p>
            </div>
        </div>

    </main>

    <script>
        // --- API CONFIGURATION ---
        const CONFIG = {
            goldKey: 'goldapi-402f6smlhxt5wy-io', // YOUR KEY INTEGRATED HERE
            goldUrl: 'https://www.goldapi.io/api/XAU/USD',
            currencyUrl: 'https://open.er-api.com/v6/latest/USD',
            adjustment: 2000 // Local premium in PKR
        };

        // --- DOM ELEMENTS ---
        const ui = {
            loader: document.getElementById('loader'),
            content: document.getElementById('content'),
            pricePKR: document.getElementById('pricePKR'),
            priceUSD: document.getElementById('priceUSD'),
            ratePKR: document.getElementById('ratePKR'),
            timestamp: document.getElementById('timestamp'),
            themeBtn: document.getElementById('themeToggle'),
            html: document.documentElement
        };

        // --- THEME LOGIC ---
        ui.themeBtn.addEventListener('click', () => {
            ui.html.classList.toggle('dark');
            ui.html.classList.toggle('light');
            
            const isLight = ui.html.classList.contains('light');
            document.body.className = isLight 
                ? 'bg-lightBg text-gray-900 h-screen w-screen flex flex-col items-center justify-center relative overflow-hidden'
                : 'bg-darkBg text-white h-screen w-screen flex flex-col items-center justify-center relative overflow-hidden';
            
            document.getElementById('sun').classList.toggle('hidden', !isLight);
            document.getElementById('moon').classList.toggle('hidden', isLight);
        });

        // --- DATA FETCHING ---
        async function refreshData() {
            try {
                // 1. Fetch Currency (Parallel request for speed)
                const currencyPromise = fetch(CONFIG.currencyUrl).then(res => res.json());
                
                // 2. Fetch Gold Price
                const goldPromise = fetch(CONFIG.goldUrl, {
                    method: 'GET',
                    headers: {
                        'x-access-token': CONFIG.goldKey,
                        'Content-Type': 'application/json'
                    }
                }).then(res => res.json());

                // Wait for both
                const [currencyData, goldData] = await Promise.all([currencyPromise, goldPromise]);

                // 3. Extract Values
                const pkrRate = currencyData.rates.PKR;
                const goldPriceUsd = goldData.price; // Price per Ounce

                if (!goldPriceUsd || !pkrRate) throw new Error("Invalid API Data");

                // 4. Calculate Formula: (Gold_Ounce_USD * 0.375 * PKR_Rate) + Local_Adjustment
                const rawPrice = (goldPriceUsd * 0.375 * pkrRate) + CONFIG.adjustment;
                const finalPrice = Math.floor(rawPrice);

                // 5. Update UI
                updateDisplay(finalPrice, goldPriceUsd, pkrRate);

            } catch (err) {
                console.error("Fetch Error:", err);
                ui.timestamp.innerText = "Error. Retrying...";
                // Retry in 5 seconds if failed
                setTimeout(refreshData, 5000);
            }
        }

        function updateDisplay(pkr, usd, rate) {
            // Hide Loader / Show Content
            ui.loader.classList.add('hidden');
            ui.content.classList.remove('hidden');
            
            // Trigger Fade In
            requestAnimationFrame(() => {
                ui.content.classList.remove('opacity-0');
            });

            // Set Values
            ui.pricePKR.innerText = pkr.toLocaleString('en-PK');
            ui.priceUSD.innerText = usd.toFixed(2);
            ui.ratePKR.innerText = Math.floor(rate);
            
            // Set Time
            const now = new Date();
            ui.timestamp.innerText = now.toLocaleTimeString('en-PK', {
                hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true
            });
        }

        // --- INIT ---
        refreshData();
        setInterval(refreshData, 600000); // 10 Minutes

    </script>
</body>
</html>
